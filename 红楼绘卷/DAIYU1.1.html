<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>林黛玉 · 天青色的泪与花 (交互式原型 V1.1)</title>
    <style>
        /* --- 全局与场景设置 --- */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap');

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Noto Serif SC', serif;
        }

        .scene-container {
            width: 100%;
            height: 100%;
            position: relative;
            background-color: #000; /* 初始黑色背景 */
            overflow: hidden;
        }

        .background {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background-color: #96C8C8; /* 天青色 */
            opacity: 0;
            z-index: 1;
        }

        /* --- 场景一: 竹影 --- */
        .bamboo-shadow {
            position: absolute;
            top: 10%;
            width: 300px;
            height: 80%;
            opacity: 0;
            filter: blur(1px);
            z-index: 2;
        }

        /* --- 场景二: 泪与诗 --- */
        .tear {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            opacity: 0;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.7);
            z-index: 20;
        }

        .ripple {
            position: absolute;
            top: 66%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            opacity: 0;
            z-index: 20;
        }
        
        .poem-line {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            color: #3d3d3d;
            font-size: 2.5vw;
            opacity: 0;
            text-shadow: 0 0 5px rgba(255,255,255,0.3);
            white-space: nowrap;
            z-index: 5; /* V1.1 Change: Set z-index for poem lines */
        }
        #poem-line-1 { top: 45%; }
        #poem-line-2 { top: 52%; }
        #poem-line-3 { top: 59%; }
        #poem-line-4 { top: 66%; }


        /* --- 场景三: 葬花 --- */
        .petal {
            position: absolute;
            /* V1.1 Change: Increased base size for better clicking */
            width: 28px;
            height: 28px;
            background-color: #D94A64;
            border-radius: 2px 50%;
            cursor: pointer;
            opacity: 0.9;
            z-index: 10; /* V1.1 Change: Petals now appear ON TOP of text */
            /* V1.1 Change: Added a larger transparent border to increase click area */
            border: 10px solid transparent; 
            background-clip: padding-box; /* Ensures the background color doesn't fill the border */
        }

        /* --- 场景四: 焚稿 --- */
        #scene-4-container {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            visibility: hidden;
            background-color: #A9A57C;
            z-index: 30;
        }

        .scroll {
            position: absolute;
            top: 15%;
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
            height: 70%;
            background-color: #f3e9d2; /* 纸张颜色 */
            border: 1px solid #c8bda7;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            box-sizing: border-box;
            clip-path: inset(0% 0% 0% 0%); 
        }
        
        /* V1.1 Enhancement: Ash particle styling */
        .ash {
            position: absolute;
            background-color: #3d3d3d;
            border-radius: 50%;
            opacity: 0.7;
        }

        .final-judgment {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4vw;
            color: #fff;
            opacity: 0;
            letter-spacing: 0.5rem;
            font-weight: 700;
            z-index: 40;
        }

        /* --- UI & Controls --- */
        .start-button, .restart-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 1rem 2rem;
            font-size: 1.5rem;
            font-family: 'Noto Serif SC', serif;
            background: rgba(255,255,255,0.1);
            border: 1px solid white;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
        }
        .start-button:hover {
            background: white;
            color: black;
        }
        .restart-button {
            opacity: 0;
            visibility: hidden;
            top: 60%;
        }

    </style>
</head>
<body>

    <div class="scene-container" id="sceneContainer">
        
        <div class="background" id="background"></div>

        <svg class="bamboo-shadow" id="bamboo1" viewBox="0 0 100 400"><path d="M 50 0 C 52 50, 48 100, 50 150 C 53 200, 47 250, 50 300 C 54 350, 46 400, 50 400" stroke="#3d3d3d" stroke-width="2" fill="none"/></svg>
        <svg class="bamboo-shadow" id="bamboo2" viewBox="0 0 100 400" style="top: 5%;"><path d="M 60 0 C 58 80, 62 160, 60 240 C 57 320, 63 400, 60 400" stroke="#3d3d3d" stroke-width="1.5" fill="none"/></svg>

        <div class="tear" id="tear"></div>
        <div class="ripple" id="ripple"></div>
        <div class="poem-line" id="poem-line-1">花谢花飞花满天</div>
        
        <div id="scene-4-container">
            <div class="scroll" id="scroll">
                <div class="poem-line final-poem-line">花谢花飞花满天，</div>
                <div class="poem-line final-poem-line">红消香断有谁怜？</div>
                <div class="poem-line final-poem-line">游丝软系飘春榭，</div>
                <div class="poem-line final-poem-line">落絮轻沾扑绣帘。</div>
            </div>
        </div>
        
        <div class="poem-line" id="poem-line-2">红消香断有谁怜？</div>
        <div class="poem-line" id="poem-line-3">游丝软系飘春榭</div>
        <div class="poem-line" id="poem-line-4">落絮轻沾扑绣帘</div>

        <div class="final-judgment" id="finalJudgment">玉带林中挂</div>
        
        <button class="start-button" id="startButton">入梦</button>
        <button class="restart-button" id="restartButton">再入梦</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const startButton = document.getElementById('startButton');
            const restartButton = document.getElementById('restartButton');
            const sceneContainer = document.getElementById('sceneContainer');

            const masterTimeline = gsap.timeline({ paused: true });

            masterTimeline.to('#background', { opacity: 1, duration: 2 })
                         .to(['#bamboo1', '#bamboo2'], { opacity: 0.6, duration: 1, stagger: 0.3 }, "-=1.5")
                         .to(['#bamboo1', '#bamboo2'], { x: '-400px', duration: 4, ease: 'power1.inOut', stagger: 0.5 }, "<")
                         .to(['#bamboo1', '#bamboo2'], { opacity: 0, duration: 1 }, "-=1");

            masterTimeline.to('#tear', { opacity: 1, duration: 0.5 })
                         .to('#tear', {
                             y: '66vh',
                             duration: 3,
                             ease: 'power2.in',
                             onComplete: () => {
                                 gsap.set('#tear', { opacity: 0 });
                                 gsap.fromTo('#ripple', { scale: 0, opacity: 1 }, { scale: 1.5, opacity: 0, duration: 1.5 });
                                 gsap.to('#poem-line-1', { opacity: 1, duration: 2, delay: 0.5 });
                             }
                         })
                         .add(startPetalScene, "+=3"); 
            
            let petalsCollected = 0;
            let poemsRevealed = 0;
            const poems = ['#poem-line-2', '#poem-line-3', '#poem-line-4'];
            const petalIntervals = [];

            function createPetal() {
                const petal = document.createElement('div');
                petal.className = 'petal';
                sceneContainer.appendChild(petal);

                // V1.1 Change: Randomize petal scale for visual variety
                const randomScale = gsap.utils.random(0.8, 1.5);

                gsap.set(petal, {
                    x: gsap.utils.random(0, window.innerWidth),
                    y: -50,
                    rotation: gsap.utils.random(0, 360),
                    scale: randomScale
                });

                const fallTimeline = gsap.to(petal, {
                    y: window.innerHeight + 50,
                    rotation: "+=" + gsap.utils.random(180, 360),
                    duration: gsap.utils.random(5, 8),
                    ease: 'none',
                    onComplete: () => petal.remove()
                });

                petal.addEventListener('click', () => {
                    fallTimeline.kill();
                    gsap.to(petal, {
                        scale: 0,
                        opacity: 0,
                        duration: 0.3,
                        onComplete: () => {
                            petal.remove();
                            petalsCollected++;
                            if (petalsCollected >= 3 && poemsRevealed < poems.length) {
                                revealNextPoem();
                                petalsCollected = 0;
                            }
                        }
                    });
                });
            }

            function revealNextPoem() {
                gsap.to(poems[poemsRevealed], { opacity: 1, duration: 2 });
                gsap.to('#background', { 
                    backgroundColor: gsap.utils.interpolate("#96C8C8", "#D94A64", (poemsRevealed + 1) / (poems.length + 1) ),
                    duration: 2
                });
                poemsRevealed++;
                if (poemsRevealed >= poems.length) {
                    petalIntervals.forEach(clearInterval);
                    gsap.delayedCall(3, startScene4);
                }
            }

            function startPetalScene() {
                petalIntervals.push(setInterval(createPetal, 600)); // slightly faster petal generation
            }

            function createAsh(x, y) {
                const ash = document.createElement('div');
                ash.className = 'ash';
                sceneContainer.appendChild(ash);
                gsap.set(ash, {
                    x: x,
                    y: y,
                    width: gsap.utils.random(2, 5),
                    height: gsap.utils.random(2, 5)
                });
                gsap.to(ash, {
                    y: '-=100',
                    x: '+=' + gsap.utils.random(-50, 50),
                    opacity: 0,
                    scale: 0.2,
                    duration: gsap.utils.random(2, 4),
                    onComplete: () => ash.remove()
                });
            }

            function startScene4() {
                const scene4tl = gsap.timeline();
                scene4tl.to(['.poem-line', '.petal', '#background'], { opacity: 0, duration: 1.5 }) 
                       .to('#scene-4-container', { opacity: 1, visibility: 'visible', duration: 1.5 }, "-=1.5")
                       .to('#scroll', {
                           // V1.1 Enhancement: More dynamic burning animation
                           onStart: () => {
                               // create ash particles along the burning edge
                               const scrollBox = document.getElementById('scroll').getBoundingClientRect();
                               const ashInterval = setInterval(() => {
                                   const progress = scrollBurn.progress();
                                   if (progress < 1) {
                                       createAsh(gsap.utils.random(scrollBox.left, scrollBox.right), scrollBox.bottom - (scrollBox.height * progress));
                                   } else {
                                       clearInterval(ashInterval);
                                   }
                               }, 50);
                           }
                       }, "+=1");
                
                const scrollBurn = gsap.to('#scroll', {
                    clipPath: 'inset(100% 0% 0% 0%)',
                    duration: 8,
                    ease: 'power1.in'
                });
                scene4tl.add(scrollBurn, "-=1")
                       // V1.1 Enhancement: Fade to black for dramatic effect
                       .to('#scene-4-container', { backgroundColor: '#000', duration: 3}, "-=4")
                       .to('#scroll', {opacity: 0, duration: 1}, "-=3")
                       // V1.1 Enhancement: More impactful final judgment reveal
                       .fromTo('#finalJudgment', 
                           { opacity: 0, scale: 1.5, filter: 'blur(10px)' }, 
                           { opacity: 1, scale: 1, filter: 'blur(0px)', duration: 3, ease: 'power2.out' }, 
                           "-=2")
                       .to('#restartButton', {opacity: 1, visibility: 'visible', duration: 1.5}, "+=2");
            }
            
            startButton.addEventListener('click', () => {
                gsap.to(startButton, {
                    opacity: 0, 
                    duration: 1,
                    onComplete: () => startButton.style.visibility = 'hidden'
                });
                masterTimeline.play();
            });

            restartButton.addEventListener('click', () => {
                window.location.reload();
            });
        });
    </script>
</body>
</html>